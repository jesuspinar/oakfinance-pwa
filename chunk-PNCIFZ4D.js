import{a as He,b as Ye,c as re,d as qe}from"./chunk-LIP5W6H7.js";import{a as Ke}from"./chunk-H3YF27BR.js";import{A as ze,B as Ne,C as Ve,E as Re,F as je,G as X,H as Z,I as ee,L as $e,M as te,N as ne,O as Ge,a as j,b as Ce,c as $,d as we,e as Me,f as ve,g as K,h as H,i as Se,j as Oe,k as Ie,l as ke,m as G,n as Ee,o as De,p as Y,q as Te,r as q,s as W,t as U,u as J,v as Le,w as Be,x as Ae,y as Q,z as Fe}from"./chunk-7LX46XF4.js";import{$ as f,Aa as me,Ba as N,D as a,Da as ge,Ea as V,F as w,H as B,M as O,R as u,S as o,T as i,U as h,_ as A,aa as x,c as L,ia as ae,ja as m,jb as I,ka as C,kb as R,la as b,lb as ue,ma as F,mb as _e,n as E,na as se,nb as he,oa as le,ob as fe,pa as de,pb as ye,q as D,sa as _,sb as Pe,ta as P,tb as xe,ua as z,ub as be,v as M,w as v,za as pe}from"./chunk-32E675WK.js";import"./chunk-KZCCWEXU.js";import"./chunk-QUJFQN2Y.js";import"./chunk-GXJYFMN2.js";import"./chunk-HZ2DEZKP.js";import"./chunk-CSZUWXLO.js";import"./chunk-H22OMIEO.js";import"./chunk-HLPRSWDU.js";import"./chunk-7Q5NTPUG.js";import"./chunk-QNCTVU3D.js";import"./chunk-NBZM3IVJ.js";import"./chunk-C6WD3CRC.js";import"./chunk-XUI3MIGA.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-VQRDGILM.js";import"./chunk-CKP3SGE2.js";import"./chunk-56YYX2RA.js";import"./chunk-34LRFQGT.js";import"./chunk-VYBL45FS.js";import"./chunk-D2O4WAW4.js";import"./chunk-N5NF6UWQ.js";import"./chunk-DNTR6X5U.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as S,b as k,h as p}from"./chunk-B7O3QC5Z.js";function et(s,c){s&1&&(o(0,"ion-text",17)(1,"p",18),m(2,"Name is required"),i()())}function tt(s,c){s&1&&(o(0,"ion-text",17)(1,"p",18),m(2,"Amount must be greater than 0"),i()())}var We=(()=>{let c=class c{constructor(e,n){this.fb=e,this.modalCtrl=n,this.type="expense"}ngOnInit(){let e=new Date().toISOString().split("T")[0];this.paymentForm=this.fb.group({name:["",[I.required,I.minLength(1)]],amount:[0,[I.required,I.min(.01)]],dueDate:[e,I.required],iconName:["cash-outline",I.required],type:[this.type,I.required]})}openIconPicker(){return p(this,null,function*(){let e=yield this.modalCtrl.create({component:He,componentProps:{selectedIcon:this.paymentForm.value.iconName,type:this.paymentForm.value.type}});yield e.present();let{data:n}=yield e.onWillDismiss();n?.icon&&this.paymentForm.patchValue({iconName:n.icon})})}save(){if(this.paymentForm.valid){let e=this.paymentForm.value,n=new Date(e.dueDate),t=new Date;t.setHours(0,0,0,0);let r=n<t;this.modalCtrl.dismiss({payment:k(S({},e),{dueDate:n,isCompleted:r,completedDate:r?n:void 0})})}}dismiss(){this.modalCtrl.dismiss()}};c.\u0275fac=function(n){return new(n||c)(w(Pe),w(te))},c.\u0275cmp=B({type:c,selectors:[["app-one-time-payment-modal"]],inputs:{period:"period",type:"type"},decls:44,vars:7,consts:[["slot","end"],[3,"click"],["name","close","slot","icon-only"],[1,"ion-padding",3,"formGroup"],["position","stacked"],["formControlName","type"],["value","expense"],["value","income"],["button","",3,"click"],[1,"icon-preview"],["size","large",3,"name","color"],["formControlName","name","placeholder","e.g., Gift, Bonus","type","text"],["color","danger",4,"ngIf"],["formControlName","amount","type","number","placeholder","0.00","step","0.01"],["formControlName","dueDate","type","date"],[1,"ion-padding-start"],["expand","block",3,"click","disabled"],["color","danger"],[1,"error-text"]],template:function(n,t){if(n&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),m(3),i(),o(4,"ion-buttons",0)(5,"ion-button",1),f("click",function(){return t.dismiss()}),h(6,"ion-icon",2),i()()()(),o(7,"ion-content")(8,"form",3)(9,"ion-item")(10,"ion-label",4),m(11,"Type"),i(),o(12,"ion-segment",5)(13,"ion-segment-button",6)(14,"ion-label"),m(15,"Expense"),i()(),o(16,"ion-segment-button",7)(17,"ion-label"),m(18,"Income"),i()()()(),o(19,"ion-item",8),f("click",function(){return t.openIconPicker()}),o(20,"ion-label",4),m(21,"Icon"),i(),o(22,"div",9),h(23,"ion-icon",10),i()(),o(24,"ion-item")(25,"ion-label",4),m(26,"Name *"),i(),h(27,"ion-input",11),i(),O(28,et,3,0,"ion-text",12),o(29,"ion-item")(30,"ion-label",4),m(31,"Amount *"),i(),h(32,"ion-input",13),i(),O(33,tt,3,0,"ion-text",12),o(34,"ion-item")(35,"ion-label",4),m(36,"Date *"),i(),h(37,"ion-input",14),i(),o(38,"ion-note",15),m(39," Past dates will be automatically marked as completed "),i()()(),o(40,"ion-footer")(41,"ion-toolbar")(42,"ion-button",16),f("click",function(){return t.save()}),m(43," Add Payment "),i()()()),n&2){let r,d;a(3),b("Add One-Time ",t.paymentForm.value.type==="income"?"Income":"Expense"),a(5),u("formGroup",t.paymentForm),a(15),u("name",t.paymentForm.value.iconName)("color",t.paymentForm.value.type==="income"?"success":"danger"),a(5),u("ngIf",((r=t.paymentForm.get("name"))==null?null:r.invalid)&&((r=t.paymentForm.get("name"))==null?null:r.touched)),a(5),u("ngIf",((d=t.paymentForm.get("amount"))==null?null:d.invalid)&&((d=t.paymentForm.get("amount"))==null?null:d.touched)),a(9),u("disabled",!t.paymentForm.valid)}},dependencies:[V,N,be,he,R,ue,fe,ye,ne,K,H,G,Y,q,W,U,J,Q,Ne,Re,je,X,Z,ee,$,we,Me],styles:["form.ion-padding[_ngcontent-%COMP%]{padding:16px}ion-item[_ngcontent-%COMP%]{--background: #252525;--border-color: transparent;--inner-border-width: 0;--padding-start: 16px;--padding-end: 16px;--min-height: 70px;margin-bottom:16px;border-radius:12px}ion-item[_ngcontent-%COMP%]   ion-label[position=stacked][_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:gray;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--padding-top: 8px;--padding-bottom: 8px;font-size:1rem;font-weight:500}ion-segment[_ngcontent-%COMP%]{margin-top:8px;--background: #333333;border-radius:12px;padding:4px}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background: transparent;--background-checked: #5CB299;--color: #B3B3B3;--color-checked: #000000;--indicator-color: transparent;--border-radius: 8px;min-height:40px;font-weight:600;font-size:.875rem;text-transform:none}.icon-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:24px 0}.icon-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:3rem;padding:16px;border-radius:16px}.icon-preview[_ngcontent-%COMP%]   ion-icon[color=success][_ngcontent-%COMP%]{background:#5cb2991f}.icon-preview[_ngcontent-%COMP%]   ion-icon[color=danger][_ngcontent-%COMP%]{background:#e573731f}.error-text[_ngcontent-%COMP%]{font-size:.75rem;padding:4px 16px;margin:-8px 0 8px;color:#e57373}ion-note[_ngcontent-%COMP%]{font-size:.75rem;color:gray;margin-top:-8px;padding-left:16px}ion-footer[_ngcontent-%COMP%]{background:#1a1a1a;border-top:1px solid rgba(255,255,255,.05)}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--padding-start: 16px;--padding-end: 16px;--padding-top: 8px;--padding-bottom: 8px;padding-bottom:env(safe-area-inset-bottom)}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: #5CB299;--background-activated: #4a9b85;--color: #000000;--border-radius: 12px;font-weight:600;font-size:1rem;height:50px}ion-footer[_ngcontent-%COMP%]   ion-button[disabled][_ngcontent-%COMP%]{--background: #333333;--color: #808080;opacity:.6}"]});let s=c;return s})();var T=(()=>{let c=class c{constructor(){}getCurrentPeriod(e,n=new Date){let t=new Date(n);t.setHours(0,0,0,0);let r=t.getDate(),d;r>=e?d=new Date(t.getFullYear(),t.getMonth(),e):d=new Date(t.getFullYear(),t.getMonth()-1,e),d.setHours(0,0,0,0);let g=new Date(d);return g.setMonth(g.getMonth()+1),g.setDate(g.getDate()-1),g.setHours(23,59,59,999),{periodStart:d,periodEnd:g,displayLabel:this.formatPeriodLabel(d,g)}}getNextPeriod(e){let n=new Date(e.periodStart);n.setMonth(n.getMonth()+1),n.setHours(0,0,0,0);let t=new Date(n);return t.setMonth(t.getMonth()+1),t.setDate(t.getDate()-1),t.setHours(23,59,59,999),{periodStart:n,periodEnd:t,displayLabel:this.formatPeriodLabel(n,t)}}getPreviousPeriod(e){let n=new Date(e.periodStart);n.setMonth(n.getMonth()-1),n.setHours(0,0,0,0);let t=new Date(n);return t.setMonth(t.getMonth()+1),t.setDate(t.getDate()-1),t.setHours(23,59,59,999),{periodStart:n,periodEnd:t,displayLabel:this.formatPeriodLabel(n,t)}}calculateDueDate(e,n){let{periodStart:t,periodEnd:r}=n,d;t.getMonth()===r.getMonth()?d=new Date(t):e>=t.getDate()?d=new Date(t):d=new Date(r.getFullYear(),r.getMonth(),1);let g=new Date(d.getFullYear(),d.getMonth(),e);return g.setHours(0,0,0,0),g.getMonth()!==d.getMonth()?new Date(d.getFullYear(),d.getMonth()+1,0,0,0,0,0):g}formatPeriodLabel(e,n){let t=e.toLocaleDateString("en-US",{month:"short",day:"numeric"}),r=n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return`${t} - ${r}`}getPeriodKey(e){return e.periodStart.toISOString().split("T")[0]}};c.\u0275fac=function(n){return new(n||c)},c.\u0275prov=E({token:c,factory:c.\u0275fac,providedIn:"root"});let s=c;return s})();var Ue=(()=>{let c=class c{constructor(e,n){this.storage=e,this.datePeriodService=n,this.STORAGE_KEY="payment_logs",this.logs$=new L([]),this.storageReady=!1,this.initStorage()}initStorage(){return p(this,null,function*(){yield this.storage.create(),this.storageReady=!0,yield this.loadLogs()})}ensureStorageReady(){return p(this,null,function*(){this.storageReady||(yield this.initStorage())})}getLogs(){return this.logs$.asObservable()}getAll(){return p(this,null,function*(){return yield this.ensureStorageReady(),((yield this.storage.get(this.STORAGE_KEY))||[]).map(n=>this.deserializeLog(n))})}getLogsByPeriod(e){return p(this,null,function*(){let n=yield this.getAll(),t=this.datePeriodService.getPeriodKey(e);return n.filter(r=>this.datePeriodService.getPeriodKey({periodStart:r.periodStart,periodEnd:r.periodEnd,displayLabel:""})===t).sort((r,d)=>r.dueDate.getTime()-d.dueDate.getTime())})}ensureLogsForPeriod(e,n){return p(this,null,function*(){yield this.ensureStorageReady();let t=yield this.getLogsByPeriod(e),r=new Set(t.map(g=>g.recurringPaymentId)),d=n.filter(g=>g.isActive&&!r.has(g.id));if(d.length>0){let g=d.map(y=>this.createLogFromPayment(y,e));yield this.createMultiple(g)}})}createLogFromPayment(e,n){let t=this.datePeriodService.calculateDueDate(e.dayOfMonth,n);return{recurringPaymentId:e.id,name:e.name,amount:e.defaultAmount,iconName:e.iconName,dayOfMonth:e.dayOfMonth,type:e.type,periodStart:n.periodStart,periodEnd:n.periodEnd,dueDate:t,isCompleted:!1}}create(e){return p(this,null,function*(){yield this.ensureStorageReady();let n=k(S({},e),{id:re(),createdAt:new Date}),t=yield this.getAll();return t.push(n),yield this.saveAll(t),n})}createMultiple(e){return p(this,null,function*(){yield this.ensureStorageReady();let n=e.map(r=>k(S({},r),{id:re(),createdAt:new Date})),t=yield this.getAll();return t.push(...n),yield this.saveAll(t),n})}update(e,n){return p(this,null,function*(){yield this.ensureStorageReady();let t=yield this.getAll(),r=t.findIndex(d=>d.id===e);r!==-1&&(t[r]=S(S({},t[r]),n),yield this.saveAll(t))})}updateLogAmount(e,n){return p(this,null,function*(){yield this.update(e,{amount:n})})}markAsCompleted(e){return p(this,null,function*(){yield this.update(e,{isCompleted:!0,completedDate:new Date})})}markAsIncomplete(e){return p(this,null,function*(){yield this.update(e,{isCompleted:!1,completedDate:void 0})})}delete(e){return p(this,null,function*(){yield this.ensureStorageReady();let t=(yield this.getAll()).filter(r=>r.id!==e);yield this.saveAll(t)})}calculateForecast(e,n){let t=n.filter(y=>!y.isCompleted),r=t.filter(y=>y.type==="expense").reduce((y,oe)=>y+oe.amount,0),d=t.filter(y=>y.type==="income").reduce((y,oe)=>y+oe.amount,0),g=e-r+d;return{pendingExpenses:r,pendingIncome:d,forecastedBalance:g}}saveAll(e){return p(this,null,function*(){let n=e.map(t=>this.serializeLog(t));yield this.storage.set(this.STORAGE_KEY,n),yield this.loadLogs()})}loadLogs(){return p(this,null,function*(){let e=yield this.getAll();this.logs$.next(e)})}serializeLog(e){return k(S({},e),{periodStart:e.periodStart.toISOString(),periodEnd:e.periodEnd.toISOString(),dueDate:e.dueDate.toISOString(),completedDate:e.completedDate?.toISOString(),createdAt:e.createdAt.toISOString()})}deserializeLog(e){return k(S({},e),{periodStart:new Date(e.periodStart),periodEnd:new Date(e.periodEnd),dueDate:new Date(e.dueDate),completedDate:e.completedDate?new Date(e.completedDate):void 0,createdAt:new Date(e.createdAt)})}};c.\u0275fac=function(n){return new(n||c)(D(j),D(T))},c.\u0275prov=E({token:c,factory:c.\u0275fac,providedIn:"root"});let s=c;return s})();var Je=(()=>{let c=class c{constructor(e,n){this.storage=e,this.datePeriodService=n,this.STORAGE_KEY="period_balances",this.balances$=new L(new Map),this.storageReady=!1,this.initStorage()}initStorage(){return p(this,null,function*(){yield this.storage.create(),this.storageReady=!0,yield this.loadBalances()})}ensureStorageReady(){return p(this,null,function*(){this.storageReady||(yield this.initStorage())})}getBalances(){return this.balances$.asObservable()}getAll(){return p(this,null,function*(){return yield this.ensureStorageReady(),(yield this.storage.get(this.STORAGE_KEY))||[]})}getBalanceForPeriod(e){return p(this,null,function*(){yield this.ensureStorageReady();let n=this.datePeriodService.getPeriodKey(e);return(yield this.getAll()).find(d=>d.periodKey===n)?.currentAccountBalance||0})}setBalanceForPeriod(e,n){return p(this,null,function*(){yield this.ensureStorageReady();let t=this.datePeriodService.getPeriodKey(e),r=yield this.getAll(),d=r.findIndex(g=>g.periodKey===t);d!==-1?r[d].currentAccountBalance=n:r.push({periodKey:t,currentAccountBalance:n}),yield this.saveAll(r)})}saveAll(e){return p(this,null,function*(){yield this.storage.set(this.STORAGE_KEY,e),yield this.loadBalances()})}loadBalances(){return p(this,null,function*(){let e=yield this.getAll(),n=new Map;e.forEach(t=>n.set(t.periodKey,t.currentAccountBalance)),this.balances$.next(n)})}};c.\u0275fac=function(n){return new(n||c)(D(j),D(T))},c.\u0275prov=E({token:c,factory:c.\u0275fac,providedIn:"root"});let s=c;return s})();function at(s,c){s&1&&(o(0,"ion-badge",32),m(1),_(2,"translate"),i()),s&2&&(a(),C(P(2,1,"tracker.now")))}function rt(s,c){if(s&1){let l=A();o(0,"ion-item-sliding")(1,"ion-item"),h(2,"ion-icon",35),o(3,"ion-label")(4,"h2"),m(5),i(),o(6,"p"),m(7),_(8,"date"),i()(),o(9,"ion-badge",36),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.editAmount(n))}),m(10),_(11,"appCurrency"),i(),o(12,"ion-checkbox",37),f("ionChange",function(){let n=M(l).$implicit,t=x(2);return v(t.toggleCompleted(n))}),i()(),o(13,"ion-item-options",38)(14,"ion-item-option",39),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.confirmDeleteLog(n))}),h(15,"ion-icon",40),i()()()}if(s&2){let l=c.$implicit;a(),ae("completed-item",l.isCompleted),a(),u("name",l.iconName)("color",l.type==="income"?"success":"danger"),a(3),C(l.name),a(2),b("Due: ",z(8,9,l.dueDate,"MMM d")),a(2),u("color",l.type==="income"?"success":"danger"),a(),b(" ",P(11,12,l.amount)," "),a(2),u("checked",l.isCompleted)}}function ct(s,c){if(s&1&&(o(0,"ion-list")(1,"ion-list-header")(2,"ion-label",33),m(3),_(4,"translate"),i()(),O(5,rt,16,14,"ion-item-sliding",34),i()),s&2){let l=x();a(3),F("",P(4,3,"tracker.due")," (",l.groupedLogs.overdue.length,")"),a(2),u("ngForOf",l.groupedLogs.overdue)}}function st(s,c){if(s&1){let l=A();o(0,"ion-item-sliding")(1,"ion-item"),h(2,"ion-icon",35),o(3,"ion-label")(4,"h2"),m(5),i(),o(6,"p"),m(7),_(8,"date"),i()(),o(9,"ion-badge",36),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.editAmount(n))}),m(10),_(11,"appCurrency"),i(),o(12,"ion-checkbox",37),f("ionChange",function(){let n=M(l).$implicit,t=x(2);return v(t.toggleCompleted(n))}),i()(),o(13,"ion-item-options",38)(14,"ion-item-option",39),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.confirmDeleteLog(n))}),h(15,"ion-icon",40),i()()()}if(s&2){let l=c.$implicit;a(),ae("completed-item",l.isCompleted),a(),u("name",l.iconName)("color",l.type==="income"?"success":"danger"),a(3),C(l.name),a(2),b("Due: ",z(8,9,l.dueDate,"MMM d")),a(2),u("color",l.type==="income"?"success":"danger"),a(),b(" ",P(11,12,l.amount)," "),a(2),u("checked",l.isCompleted)}}function lt(s,c){if(s&1&&(o(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),m(3),_(4,"translate"),i()(),O(5,st,16,14,"ion-item-sliding",34),i()),s&2){let l=x();a(3),F("",P(4,3,"tracker.pending")," (",l.groupedLogs.upcoming.length,")"),a(2),u("ngForOf",l.groupedLogs.upcoming)}}function dt(s,c){if(s&1){let l=A();o(0,"ion-item-sliding")(1,"ion-item",42),h(2,"ion-icon",35),o(3,"ion-label")(4,"h2"),m(5),i(),o(6,"p"),m(7),_(8,"date"),i()(),o(9,"ion-badge",36),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.editAmount(n))}),m(10),_(11,"appCurrency"),i(),o(12,"ion-checkbox",37),f("ionChange",function(){let n=M(l).$implicit,t=x(2);return v(t.toggleCompleted(n))}),i()(),o(13,"ion-item-options",38)(14,"ion-item-option",39),f("click",function(){let n=M(l).$implicit,t=x(2);return v(t.confirmDeleteLog(n))}),h(15,"ion-icon",40),i()()()}if(s&2){let l=c.$implicit;a(2),u("name",l.iconName)("color",l.type==="income"?"success":"danger"),a(3),C(l.name),a(2),b("Completed: ",z(8,7,l.completedDate,"MMM d")),a(2),u("color",l.type==="income"?"success":"danger"),a(),b(" ",P(11,10,l.amount)," "),a(2),u("checked",l.isCompleted)}}function pt(s,c){if(s&1&&(o(0,"ion-list")(1,"ion-list-header")(2,"ion-label",41),m(3),_(4,"translate"),i()(),O(5,dt,16,12,"ion-item-sliding",34),i()),s&2){let l=x();a(3),F("",P(4,3,"tracker.completed")," (",l.groupedLogs.completed.length,")"),a(2),u("ngForOf",l.groupedLogs.completed)}}function mt(s,c){s&1&&(o(0,"div",43),h(1,"ion-icon",44),o(2,"p"),m(3,"No payments for this period"),i(),o(4,"ion-text",11)(5,"p"),m(6,"Add recurring payments to track them here"),i()()())}var Tt=(()=>{let c=class c{constructor(e,n,t,r,d,g,y){this.paymentLogService=e,this.recurringPaymentService=n,this.datePeriodService=t,this.balanceService=r,this.settingsService=d,this.alertCtrl=g,this.modalCtrl=y,this.currentPeriod={periodStart:new Date,periodEnd:new Date,displayLabel:""},this.allLogs=[],this.groupedLogs={overdue:[],upcoming:[],completed:[]},this.currentBalance=0,this.currencySymbol="$",this.forecast={pendingExpenses:0,pendingIncome:0,forecastedBalance:0}}ngOnInit(){return p(this,null,function*(){yield this.initializePage()})}ionViewWillEnter(){return p(this,null,function*(){yield this.initializePage()})}initializePage(){return p(this,null,function*(){yield this.loadCurrentPeriod(),yield this.loadCurrencySymbol(),yield this.ensureLogsExist(),yield this.loadPaymentLogs(),yield this.loadBalance(),this.calculateForecast()})}loadCurrencySymbol(){return p(this,null,function*(){let e=yield this.settingsService.get();this.currencySymbol=e.currencySymbol})}loadCurrentPeriod(){return p(this,null,function*(){let e=yield this.settingsService.getMonthStartDay();this.currentPeriod=this.datePeriodService.getCurrentPeriod(e)})}ensureLogsExist(){return p(this,null,function*(){let e=yield this.recurringPaymentService.getAllSortedByDay();yield this.paymentLogService.ensureLogsForPeriod(this.currentPeriod,e)})}loadPaymentLogs(){return p(this,null,function*(){this.allLogs=yield this.paymentLogService.getLogsByPeriod(this.currentPeriod),this.organizePaymentLogs()})}loadBalance(){return p(this,null,function*(){this.currentBalance=yield this.balanceService.getBalanceForPeriod(this.currentPeriod)})}organizePaymentLogs(){let e=new Date;e.setHours(0,0,0,0);let n=[],t=[],r=[];this.allLogs.forEach(g=>{g.isCompleted?r.push(g):g.dueDate<e?n.push(g):t.push(g)});let d=(g,y)=>g.dueDate.getTime()-y.dueDate.getTime();n.sort(d),t.sort(d),r.sort((g,y)=>(y.completedDate?.getTime()||0)-(g.completedDate?.getTime()||0)),this.groupedLogs={overdue:n,upcoming:t,completed:r}}calculateForecast(){this.forecast=this.paymentLogService.calculateForecast(this.currentBalance,this.allLogs)}previousMonth(){return p(this,null,function*(){this.currentPeriod=this.datePeriodService.getPreviousPeriod(this.currentPeriod),yield this.ensureLogsExist(),yield this.loadPaymentLogs(),yield this.loadBalance(),this.calculateForecast()})}nextMonth(){return p(this,null,function*(){this.currentPeriod=this.datePeriodService.getNextPeriod(this.currentPeriod),yield this.ensureLogsExist(),yield this.loadPaymentLogs(),yield this.loadBalance(),this.calculateForecast()})}toggleCompleted(e){return p(this,null,function*(){e.isCompleted?yield this.paymentLogService.markAsIncomplete(e.id):yield this.paymentLogService.markAsCompleted(e.id),yield this.loadPaymentLogs(),this.calculateForecast()})}editAmount(e){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:"Edit Amount",subHeader:e.name,inputs:[{name:"amount",type:"number",placeholder:"Amount",value:e.amount,min:.01}],buttons:[{text:"Cancel",role:"cancel"},{text:"Save",handler:t=>p(this,null,function*(){t.amount&&t.amount>0&&(yield this.paymentLogService.updateLogAmount(e.id,parseFloat(t.amount)),yield this.loadPaymentLogs(),this.calculateForecast())})}]})).present()})}confirmDeleteLog(e){return p(this,null,function*(){yield(yield this.alertCtrl.create({header:"Delete Payment",message:`Are you sure you want to delete "${e.name}"?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"destructive",handler:()=>p(this,null,function*(){yield this.paymentLogService.delete(e.id),yield this.loadPaymentLogs(),this.calculateForecast()})}]})).present()})}onBalanceChange(){return p(this,null,function*(){yield this.balanceService.setBalanceForPeriod(this.currentPeriod,this.currentBalance),this.calculateForecast()})}getForecastColor(){return this.forecast.forecastedBalance>=0?"success":this.forecast.forecastedBalance>=-100?"warning":"danger"}isCurrentPeriod(){let e=new Date;return e>=this.currentPeriod.periodStart&&e<=this.currentPeriod.periodEnd}openAddOneTimePayment(){return p(this,null,function*(){let e=yield this.modalCtrl.create({component:We,componentProps:{period:this.currentPeriod,type:"expense"}});yield e.present();let{data:n}=yield e.onWillDismiss();n?.payment&&(yield this.createOneTimePayment(n.payment))})}createOneTimePayment(e){return p(this,null,function*(){let n={recurringPaymentId:void 0,name:e.name,amount:e.amount,dueDate:e.dueDate,isCompleted:e.isCompleted,completedDate:e.completedDate,iconName:e.iconName,dayOfMonth:e.dueDate.getDate(),type:e.type,periodStart:this.currentPeriod.periodStart,periodEnd:this.currentPeriod.periodEnd};yield this.paymentLogService.create(n),yield this.loadPaymentLogs(),this.calculateForecast()})}};c.\u0275fac=function(n){return new(n||c)(w(Ue),w(qe),w(T),w(Je),w(Ge),w($e),w(te))},c.\u0275cmp=B({type:c,selectors:[["app-payment-tracker"]],decls:72,vars:38,consts:[[3,"translucent"],["slot","start"],[3,"click"],["name","chevron-back","slot","icon-only"],["color","primary","style","margin-left: 8px; font-size: 10px; vertical-align: middle;",4,"ngIf"],["slot","end"],["name","chevron-forward","slot","icon-only"],[1,"ion-padding-bottom",3,"fullscreen"],[1,"summary-card"],["size","6"],[1,"summary-item"],["color","medium"],[1,"income-text"],[1,"expense-text"],[4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"forecast-footer"],[1,"footer-card"],[1,"ion-align-items-center"],[1,"balance-input-wrapper"],[1,"balance-label"],[1,"balance-input-container"],[1,"currency-prefix"],["type","number","placeholder","0.00",1,"balance-input",3,"ngModelChange","ionChange","ngModel"],[1,"forecast-display"],[1,"forecast-label"],[1,"forecast-amount",3,"ngClass"],[1,"forecast-details"],["name","arrow-down","color","danger"],["name","arrow-up","color","success"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["color","primary",2,"margin-left","8px","font-size","10px","vertical-align","middle"],["color","danger"],[4,"ngFor","ngForOf"],["slot","start",3,"name","color"],["slot","end",1,"clickable-badge",3,"click","color"],["slot","end",3,"ionChange","checked"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],["color","success"],[1,"completed-item"],[1,"empty-state"],["name","calendar-outline","color","medium"]],template:function(n,t){n&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),f("click",function(){return t.previousMonth()}),h(4,"ion-icon",3),i()(),o(5,"ion-title"),m(6),O(7,at,3,3,"ion-badge",4),i(),o(8,"ion-buttons",5)(9,"ion-button",2),f("click",function(){return t.nextMonth()}),h(10,"ion-icon",6),i()()()(),o(11,"ion-content",7)(12,"ion-card",8)(13,"ion-card-content")(14,"ion-grid")(15,"ion-row")(16,"ion-col",9)(17,"div",10)(18,"ion-text",11)(19,"p"),m(20),_(21,"translate"),i()(),o(22,"h2",12),m(23),_(24,"appCurrency"),i()()(),o(25,"ion-col",9)(26,"div",10)(27,"ion-text",11)(28,"p"),m(29),_(30,"translate"),i()(),o(31,"h2",13),m(32),_(33,"appCurrency"),i()()()()()()(),O(34,ct,6,5,"ion-list",14)(35,lt,6,5,"ion-list",14)(36,pt,6,5,"ion-list",14)(37,mt,7,0,"div",15),i(),o(38,"ion-footer",16)(39,"ion-card",17)(40,"ion-card-content")(41,"ion-grid")(42,"ion-row",18)(43,"ion-col",9)(44,"div",19)(45,"ion-label",20),m(46),_(47,"translate"),i(),o(48,"div",21)(49,"span",22),m(50),i(),o(51,"ion-input",23),de("ngModelChange",function(d){return le(t.currentBalance,d)||(t.currentBalance=d),d}),f("ionChange",function(){return t.onBalanceChange()}),i()()()(),o(52,"ion-col",9)(53,"div",24)(54,"ion-text",11)(55,"p",25),m(56),_(57,"translate"),i()(),o(58,"h2",26),m(59),_(60,"appCurrency"),i(),o(61,"ion-text",11)(62,"p",27),h(63,"ion-icon",28),m(64),_(65,"appCurrency"),h(66,"ion-icon",29),m(67),_(68,"appCurrency"),i()()()()()()()()(),o(69,"ion-fab",30)(70,"ion-fab-button",2),f("click",function(){return t.openAddOneTimePayment()}),h(71,"ion-icon",31),i()()),n&2&&(u("translucent",!0),a(6),b(" ",t.currentPeriod.displayLabel," "),a(),u("ngIf",t.isCurrentPeriod()),a(4),u("fullscreen",!0),a(9),C(P(21,20,"tracker.pendingIncome")),a(3),C(P(24,22,t.forecast.pendingIncome)),a(6),C(P(30,24,"tracker.pendingExpenses")),a(3),C(P(33,26,t.forecast.pendingExpenses)),a(2),u("ngIf",t.groupedLogs.overdue.length>0),a(),u("ngIf",t.groupedLogs.upcoming.length>0),a(),u("ngIf",t.groupedLogs.completed.length>0),a(),u("ngIf",t.allLogs.length===0),a(9),C(P(47,28,"tracker.currentBalance")),a(4),C(t.currencySymbol),a(),se("ngModel",t.currentBalance),a(5),C(P(57,30,"tracker.forecastedBalance")),a(2),u("ngClass",t.getForecastColor()+"-text"),a(),b(" ",P(60,32,t.forecast.forecastedBalance)," "),a(5),b(" ",P(65,34,t.forecast.pendingExpenses)," "),a(3),b(" ",P(68,36,t.forecast.pendingIncome)," "))},dependencies:[ne,ve,K,H,Se,Oe,Ie,ke,G,Ee,De,Y,Te,q,W,U,J,Le,Be,Ae,Q,Fe,ze,Ve,X,Z,ee,Ce,$,V,pe,me,N,xe,R,_e,ge,Ye,Ke],styles:[".summary-card[_ngcontent-%COMP%]{margin:16px;border-radius:16px;background:linear-gradient(145deg,#252525,#1f1f1f);border:1px solid rgba(255,255,255,.05);box-shadow:0 8px 32px #0000004d}.summary-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:24px 16px}.summary-item[_ngcontent-%COMP%]{text-align:center;padding:8px 0}.summary-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;font-size:.6875rem;text-transform:uppercase;font-weight:700;letter-spacing:.75px;color:gray}.summary-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:700;letter-spacing:-.5px}.income-text[_ngcontent-%COMP%]{color:#5cb299}.expense-text[_ngcontent-%COMP%]{color:#e57373}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0}ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{padding:24px 16px 8px}ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.75px;display:flex;align-items:center;gap:8px}ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[color=danger][_ngcontent-%COMP%]{color:#e57373}ion-list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]   ion-label[color=success][_ngcontent-%COMP%]{color:#5cb299}ion-item-sliding[_ngcontent-%COMP%]{margin:0 16px 8px;border-radius:12px;overflow:hidden}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #252525;--background-hover: #2D2D2D;--min-height: 68px;--padding-start: 16px;--padding-end: 8px;margin:0;border-radius:0}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{font-size:1.375rem;padding:10px;border-radius:12px;margin-right:16px}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[slot=start][color=success][_ngcontent-%COMP%]{background:#5cb2991f}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[slot=start][color=danger][_ngcontent-%COMP%]{background:#e573731f}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:.9375rem;font-weight:500;color:#fff;margin-bottom:2px}ion-item-sliding[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.75rem;color:#b3b3b3}.clickable-badge[_ngcontent-%COMP%]{cursor:pointer;font-size:.9375rem;font-weight:600;padding:8px 16px;border-radius:8px;min-width:75px;text-align:center;transition:all .2s ease}.clickable-badge[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.clickable-badge[_ngcontent-%COMP%]:active{transform:scale(.98)}.clickable-badge[color=success][_ngcontent-%COMP%]{background:#5cb29926;color:#5cb299}.clickable-badge[color=danger][_ngcontent-%COMP%]{background:#e5737326;color:#e57373}ion-checkbox[_ngcontent-%COMP%]{margin-left:8px;--size: 24px;--border-radius: 6px;--background: #333333;--background-checked: #5CB299;--border-color: rgba(255, 255, 255, .1);--border-color-checked: #5CB299;--checkmark-color: #000000}.completed-item[_ngcontent-%COMP%]{opacity:.5}.completed-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .completed-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-decoration:line-through}ion-item-options[_ngcontent-%COMP%]   ion-item-option[color=danger][_ngcontent-%COMP%]{--background: #E57373;--color: #000000;min-width:70px}ion-item-options[_ngcontent-%COMP%]   ion-item-option[color=danger][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.375rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 24px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:100px;color:gray;margin-bottom:24px;opacity:.4;background:#ffffff08;padding:24px;border-radius:50%}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:500;color:#fff;margin:8px 0}.empty-state[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;color:#b3b3b3;margin:8px 0 0;max-width:250px;line-height:1.5}.forecast-footer[_ngcontent-%COMP%]{background:#252525;box-shadow:0 -8px 32px #0006;border-top:1px solid rgba(255,255,255,.05)}.footer-card[_ngcontent-%COMP%]{margin:0;box-shadow:none;background:transparent}.footer-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-label[_ngcontent-%COMP%]{display:block;font-size:.6875rem;font-weight:700;text-transform:uppercase;letter-spacing:.75px;color:gray;margin-bottom:8px}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#333;border-radius:12px;padding:16px;border:2px solid transparent;transition:all .3s ease}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-input-container[_ngcontent-%COMP%]:focus-within{border-color:#5cb299;background:#2d2d2d;box-shadow:0 0 0 4px #5cb2991a}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-input-container[_ngcontent-%COMP%]   .currency-prefix[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#5cb299;margin-right:8px}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-input-container[_ngcontent-%COMP%]   .balance-input[_ngcontent-%COMP%]{flex:1;font-size:1.25rem;font-weight:600;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;--background: transparent;color:#fff}.balance-input-wrapper[_ngcontent-%COMP%]   .balance-input-container[_ngcontent-%COMP%]   .balance-input[_ngcontent-%COMP%]::part(native){padding:0}.forecast-display[_ngcontent-%COMP%]{text-align:center;padding:4px 0}.forecast-display[_ngcontent-%COMP%]   .forecast-label[_ngcontent-%COMP%]{margin:0 0 4px;font-size:.6875rem;text-transform:uppercase;font-weight:700;letter-spacing:.75px;color:gray}.forecast-display[_ngcontent-%COMP%]   .forecast-amount[_ngcontent-%COMP%]{margin:4px 0;font-size:1.75rem;font-weight:700;letter-spacing:-.5px}.forecast-display[_ngcontent-%COMP%]   .forecast-details[_ngcontent-%COMP%]{margin:8px 0 0;font-size:.75rem;display:flex;align-items:center;justify-content:center;gap:16px;color:#b3b3b3}.forecast-display[_ngcontent-%COMP%]   .forecast-details[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.875rem;margin-right:2px}.success-text[_ngcontent-%COMP%]{color:#5cb299}.warning-text[_ngcontent-%COMP%]{color:#e8c547}.danger-text[_ngcontent-%COMP%]{color:#e57373}ion-fab[_ngcontent-%COMP%]{margin-bottom:200px}ion-fab[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]{--background: #5CB299;--background-activated: #4a9b85;--color: #000000;--box-shadow: 0 4px 20px rgba($oak-green, .4);width:56px;height:56px}ion-fab[_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}"]});let s=c;return s})();export{Tt as PaymentTrackerPage};
